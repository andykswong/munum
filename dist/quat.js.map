{"version":3,"sources":["../assembly/quat.ts"],"names":["array","mat4","vec3","vec4","EPSILON","fequal","q1","create","q2","rotateAxis","axis","angle","out","scale","Math","sin","cos","rotateX","rotateY","rotateZ","rotateTo","from","to","dot","PI","cross","norm","toMat4","q","xx","xy","xz","yy","yz","zz","wx","wy","wz","copy","len2","len","conj","invert","l","mul","a","b","ax","ay","az","aw","bx","by","bz","bw","rotateVec3","v","lerp","t","cosTheta","magB","slerp","scale0","scale1","theta","acos","sinTheta"],"mappings":"MACO,GAAKA,CAAAA,K,wBACL,GAAKC,CAAAA,I,uBACL,GAAKC,CAAAA,I,uBACL,GAAKC,CAAAA,I,wBACHC,O,CAASC,M,mBAGlB,KAAMC,CAAAA,EAAQ,CAAGC,MAAM,EAAvB,CACA,KAAMC,CAAAA,EAAQ,CAAGD,MAAM,EAAvB,CAMA,MAAO,SAASA,CAAAA,MAAT,EAAwB,CAC7B,MAAO,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAAU,CAAV,CACR,CAKD,MAAO,SAASE,CAAAA,UAAT,CAAoBC,IAApB,CAAwCC,KAAxC,CAAsDC,GAAS,CAAGL,MAAM,EAAxE,CAAkF,CACvFP,KAAK,CAACa,KAAN,CAAYH,IAAZ,CAAkBI,IAAI,CAACC,GAAL,CAASJ,KAAK,CAAG,CAAjB,CAAlB,CAAgDC,GAAhD,EACUA,GAAG,CAAC,CAAD,CAAH,CAASE,IAAI,CAACE,GAAL,CAASL,KAAK,CAAG,CAAjB,CAAnB,CACA,MAAOC,CAAAA,GACR,CAMD,MAAO,SAASK,CAAAA,OAAT,CAAiBN,KAAjB,CAA+BC,GAAS,CAAGL,MAAM,EAAjD,CAA2D,CACtDK,GAAG,CAAC,CAAD,CAAH,CAASE,IAAI,CAACC,GAAL,CAASJ,KAAK,CAAG,CAAjB,CAAnB,CACUC,GAAG,CAAC,CAAD,CAAH,CAASE,IAAI,CAACE,GAAL,CAASL,KAAK,CAAG,CAAjB,CAAnB,CACUC,GAAG,CAAC,CAAD,CAAH,CAASA,GAAG,CAAC,CAAD,CAAH,CAAS,CAA5B,CACA,MAAOA,CAAAA,GACR,CAMD,MAAO,SAASM,CAAAA,OAAT,CAAiBP,KAAjB,CAA+BC,GAAS,CAAGL,MAAM,EAAjD,CAA2D,CACtDK,GAAG,CAAC,CAAD,CAAH,CAASE,IAAI,CAACC,GAAL,CAASJ,KAAK,CAAG,CAAjB,CAAnB,CACUC,GAAG,CAAC,CAAD,CAAH,CAASE,IAAI,CAACE,GAAL,CAASL,KAAK,CAAG,CAAjB,CAAnB,CACUC,GAAG,CAAC,CAAD,CAAH,CAASA,GAAG,CAAC,CAAD,CAAH,CAAS,CAA5B,CACA,MAAOA,CAAAA,GACR,CAMD,MAAO,SAASO,CAAAA,OAAT,CAAiBR,KAAjB,CAA+BC,GAAS,CAAGL,MAAM,EAAjD,CAA2D,CACtDK,GAAG,CAAC,CAAD,CAAH,CAASE,IAAI,CAACC,GAAL,CAASJ,KAAK,CAAG,CAAjB,CAAnB,CACUC,GAAG,CAAC,CAAD,CAAH,CAASE,IAAI,CAACE,GAAL,CAASL,KAAK,CAAG,CAAjB,CAAnB,CACUC,GAAG,CAAC,CAAD,CAAH,CAASA,GAAG,CAAC,CAAD,CAAH,CAAS,CAA5B,CACA,MAAOA,CAAAA,GACR,CAMD,MAAO,SAASQ,CAAAA,QAAT,CAAkBC,IAAlB,CAAsCC,EAAtC,CAAwDV,GAAS,CAAGL,MAAM,EAA1E,CAAoF,CACzF,KAAMgB,CAAAA,GAAU,CAAGrB,IAAI,CAACqB,GAAL,CAASF,IAAT,CAAeC,EAAf,CAAnB,CAEA,GAAIjB,MAAM,CAACkB,GAAD,CAAM,CAAC,CAAP,CAAV,CAAqB,CAETX,GAAG,CAAC,CAAD,CAAH,CAAS,CAAnB,CACUA,GAAG,CAAC,CAAD,CAAH,CAASS,IAAI,CAAC,CAAD,CAAvB,CACUT,GAAG,CAAC,CAAD,CAAH,CAAS,CAACS,IAAI,CAAC,CAAD,CAAxB,CACA,MAAOZ,CAAAA,UAAU,CAACG,GAAD,CAAqBE,IAAI,CAACU,EAA1B,CAAuCZ,GAAvC,CAClB,CAND,IAMO,IAAIP,MAAM,CAACkB,GAAD,CAAM,CAAN,CAAV,CAAoB,CACfX,GAAG,CAAC,CAAD,CAAH,CAASA,GAAG,CAAC,CAAD,CAAH,CAASA,GAAG,CAAC,CAAD,CAAH,CAAS,CAArC,CACUA,GAAG,CAAC,CAAD,CAAH,CAAS,CAAnB,CACA,MAAOA,CAAAA,GACR,CAGDV,IAAI,CAACuB,KAAL,CAAWJ,IAAX,CAAiBC,EAAjB,CAAqBV,GAArB,EACUA,GAAG,CAAC,CAAD,CAAH,CAAS,EAAIW,GAAvB,CACA,MAAOG,CAAAA,IAAI,CAACd,GAAD,CAAMA,GAAN,CACZ,CAMD,MAAO,SAASe,CAAAA,MAAT,CAAgBC,CAAhB,CAAiChB,GAAS,CAAGX,IAAI,CAACM,MAAL,EAA7C,CAAkE,CACvE,KACEsB,CAAAA,EAAS,CAAaD,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CADhC,CAEEE,EAAS,CAAaF,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CAFhC,CAGEG,EAAS,CAAaH,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CAHhC,CAIEI,EAAS,CAAaJ,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CAJhC,CAKEK,EAAS,CAAaL,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CALhC,CAMEM,EAAS,CAAaN,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CANhC,CAOEO,EAAS,CAAaP,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CAPhC,CAQEQ,EAAS,CAAaR,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CARhC,CASES,EAAS,CAAaT,CAAC,CAAC,CAAD,CAAD,CAAOA,CAAC,CAAC,CAAD,CAThC,CAWUhB,GAAG,CAAC,CAAD,CAAH,CAAS,EAAI,GAAKoB,EAAE,CAAGE,EAAV,CAAvB,CACUtB,GAAG,CAAC,CAAD,CAAH,CAAS,GAAKkB,EAAE,CAAGO,EAAV,CAAnB,CACUzB,GAAG,CAAC,CAAD,CAAH,CAAS,GAAKmB,EAAE,CAAGK,EAAV,CAAnB,CACUxB,GAAG,CAAC,CAAD,CAAH,CAAS,GAAKkB,EAAE,CAAGO,EAAV,CAAnB,CACUzB,GAAG,CAAC,CAAD,CAAH,CAAS,EAAI,GAAKiB,EAAE,CAAGK,EAAV,CAAvB,CACUtB,GAAG,CAAC,CAAD,CAAH,CAAS,GAAKqB,EAAE,CAAGE,EAAV,CAAnB,CACUvB,GAAG,CAAC,CAAD,CAAH,CAAS,GAAKmB,EAAE,CAAGK,EAAV,CAAnB,CACUxB,GAAG,CAAC,CAAD,CAAH,CAAS,GAAKqB,EAAE,CAAGE,EAAV,CAAnB,CACUvB,GAAG,CAAC,EAAD,CAAH,CAAU,EAAI,GAAKiB,EAAE,CAAGG,EAAV,CAAxB,CAEUpB,GAAG,CAAC,CAAD,CAAH,CAASA,GAAG,CAAC,CAAD,CAAH,CAASA,GAAG,CAAC,EAAD,CAAH,CAAUA,GAAG,CAAC,EAAD,CAAH,CAAUA,GAAG,CAAC,EAAD,CAAH,CAAUA,GAAG,CAAC,EAAD,CAAH,CAAU,CAApE,CACUA,GAAG,CAAC,EAAD,CAAH,CAAU,CAApB,CACA,MAAOA,CAAAA,GACR,CAMD,MAAO,SAAS0B,CAAAA,IAAT,CAAcV,CAAd,CAA+BhB,GAAS,CAAGL,MAAM,EAAjD,CAA2D,CAChE,MAAOP,CAAAA,KAAK,CAACsC,IAAN,CAAWV,CAAX,CAAchB,GAAd,CACR,CAMD,MAAO,MAAMW,CAAAA,GAAgD,CAAGvB,KAAK,CAACuB,GAA/D,CAMP,MAAO,MAAMgB,CAAAA,IAAgC,CAAGpC,IAAI,CAACoC,IAA9C,CAMP,MAAO,MAAMC,CAAAA,GAA+B,CAAGrC,IAAI,CAACqC,GAA7C,CAKP,MAAO,MAAMd,CAAAA,IAA2C,CAAGvB,IAAI,CAACuB,IAAzD,CAKP,MAAO,SAASe,CAAAA,IAAT,CAAcb,CAAd,CAA+BhB,GAAS,CAAGL,MAAM,EAAjD,CAA2D,CACtDK,GAAG,CAAC,CAAD,CAAH,CAAS,CAACgB,CAAC,CAAC,CAAD,CAArB,CACUhB,GAAG,CAAC,CAAD,CAAH,CAAS,CAACgB,CAAC,CAAC,CAAD,CAArB,CACUhB,GAAG,CAAC,CAAD,CAAH,CAAS,CAACgB,CAAC,CAAC,CAAD,CAArB,CACUhB,GAAG,CAAC,CAAD,CAAH,CAASgB,CAAC,CAAC,CAAD,CAApB,CACA,MAAOhB,CAAAA,GACR,CAKD,MAAO,SAAS8B,CAAAA,MAAT,CAAgBd,CAAhB,CAAiChB,GAAS,CAAGL,MAAM,EAAnD,CAA6D,CAClE,KAAMoC,CAAAA,CAAQ,CAAG,GAAKJ,IAAI,CAACX,CAAD,CAAJ,EAAW,CAAhB,CAAjB,CACUhB,GAAG,CAAC,CAAD,CAAH,CAAS,CAACgB,CAAC,CAAC,CAAD,CAAF,CAAQe,CAA3B,CACU/B,GAAG,CAAC,CAAD,CAAH,CAAS,CAACgB,CAAC,CAAC,CAAD,CAAF,CAAQe,CAA3B,CACU/B,GAAG,CAAC,CAAD,CAAH,CAAS,CAACgB,CAAC,CAAC,CAAD,CAAF,CAAQe,CAA3B,CACU/B,GAAG,CAAC,CAAD,CAAH,CAASgB,CAAC,CAAC,CAAD,CAAD,CAAOe,CAA1B,CACA,MAAO/B,CAAAA,GACR,CAMD,MAAO,SAASgC,CAAAA,GAAT,CAAaC,CAAb,CAA8BC,CAA9B,CAA+ClC,GAAS,CAAGL,MAAM,EAAjE,CAA2E,CAChF,KACEwC,CAAAA,EAAS,CAAaF,CAAC,CAAC,CAAD,CADzB,CAEEG,EAAS,CAAaH,CAAC,CAAC,CAAD,CAFzB,CAGEI,EAAS,CAAaJ,CAAC,CAAC,CAAD,CAHzB,CAIEK,EAAS,CAAaL,CAAC,CAAC,CAAD,CAJzB,CAKEM,EAAS,CAAaL,CAAC,CAAC,CAAD,CALzB,CAMEM,EAAS,CAAaN,CAAC,CAAC,CAAD,CANzB,CAOEO,EAAS,CAAaP,CAAC,CAAC,CAAD,CAPzB,CAQEQ,EAAS,CAAaR,CAAC,CAAC,CAAD,CARzB,CASUlC,GAAG,CAAC,CAAD,CAAH,CAASsC,EAAE,CAAGC,EAAL,CAAUJ,EAAE,CAAGO,EAAf,CAAoBN,EAAE,CAAGK,EAAzB,CAA8BJ,EAAE,CAAGG,EAAtD,CACUxC,GAAG,CAAC,CAAD,CAAH,CAASsC,EAAE,CAAGE,EAAL,CAAUJ,EAAE,CAAGM,EAAf,CAAoBL,EAAE,CAAGE,EAAzB,CAA8BJ,EAAE,CAAGM,EAAtD,CACUzC,GAAG,CAAC,CAAD,CAAH,CAASsC,EAAE,CAAGG,EAAL,CAAUJ,EAAE,CAAGK,EAAf,CAAoBP,EAAE,CAAGK,EAAzB,CAA8BJ,EAAE,CAAGG,EAAtD,CACUvC,GAAG,CAAC,CAAD,CAAH,CAASsC,EAAE,CAAGI,EAAL,CAAUP,EAAE,CAAGI,EAAf,CAAoBH,EAAE,CAAGI,EAAzB,CAA8BH,EAAE,CAAGI,EAAtD,CACA,MAAOzC,CAAAA,GACR,CAOD,MAAO,SAAS2C,CAAAA,UAAT,CAAoB3B,CAApB,CAAqC4B,CAArC,CAAsD5C,GAAS,CAAGV,IAAI,CAACK,MAAL,EAAlE,CAAuF,CAC5FP,KAAK,CAACsC,IAAN,CAAWkB,CAAX,CAAclD,EAAd,CAAkB,CAAlB,CAAqB,CAArB,CAAwB,CAAxB,EACUA,EAAE,CAAC,CAAD,CAAF,CAAQ,CAAlB,CACAsC,GAAG,CAACA,GAAG,CAAChB,CAAD,CAAItB,EAAJ,CAAQA,EAAR,CAAJ,CAAiBoC,MAAM,CAACd,CAAD,CAAIpB,EAAJ,CAAvB,CAAgCF,EAAhC,CAAH,CACA,MAAON,CAAAA,KAAK,CAACsC,IAAN,CAAWhC,EAAX,CAAeM,GAAf,CAAoB,CAApB,CAAuB,CAAvB,CAA0B,CAA1B,CACR,CAMD,MAAO,SAAS6C,CAAAA,IAAT,CAAcZ,CAAd,CAA+BC,CAA/B,CAAgDY,CAAhD,CAA0D9C,GAAS,CAAGL,MAAM,EAA5E,CAAsF,CAC3F,KAAMoD,CAAAA,QAAe,CAAGpC,GAAG,CAACsB,CAAD,CAAIC,CAAJ,CAA3B,CACA,KAAMc,CAAAA,IAAW,CAAID,QAAQ,CAAG,CAAZ,CAAiB,CAAC,CAAlB,CAAsB,CAA1C,CAGU/C,GAAG,CAAC,CAAD,CAAH,CAASiC,CAAC,CAAC,CAAD,CAAD,EAAQ,EAAIa,CAAZ,EAAiBZ,CAAC,CAAC,CAAD,CAAD,CAAOc,IAAP,CAAcF,CAAlD,CACU9C,GAAG,CAAC,CAAD,CAAH,CAASiC,CAAC,CAAC,CAAD,CAAD,EAAQ,EAAIa,CAAZ,EAAiBZ,CAAC,CAAC,CAAD,CAAD,CAAOc,IAAP,CAAcF,CAAlD,CACU9C,GAAG,CAAC,CAAD,CAAH,CAASiC,CAAC,CAAC,CAAD,CAAD,EAAQ,EAAIa,CAAZ,EAAiBZ,CAAC,CAAC,CAAD,CAAD,CAAOc,IAAP,CAAcF,CAAlD,CACU9C,GAAG,CAAC,CAAD,CAAH,CAASiC,CAAC,CAAC,CAAD,CAAD,EAAQ,EAAIa,CAAZ,EAAiBZ,CAAC,CAAC,CAAD,CAAD,CAAOc,IAAP,CAAcF,CAAlD,CAEA,MAAOhC,CAAAA,IAAI,CAACd,GAAD,CACZ,CAKD,MAAO,SAASiD,CAAAA,KAAT,CAAehB,CAAf,CAAgCC,CAAhC,CAAiDY,CAAjD,CAA2D9C,GAAS,CAAGL,MAAM,EAA7E,CAAuF,CAC5F,GAAIoD,CAAAA,QAAe,CAAGpC,GAAG,CAACsB,CAAD,CAAIC,CAAJ,CAAzB,CACA,GAAIc,CAAAA,IAAW,CAAG,CAAlB,CAEA,GAAID,QAAQ,CAAG,CAAf,CAAkB,CAChBA,QAAQ,EAAI,CAAC,CAAb,CACAC,IAAI,CAAG,CAAC,CACT,CAGD,GAAIE,CAAAA,MAAa,CAAG,EAAIJ,CAAxB,CACA,GAAIK,CAAAA,MAAa,CAAGL,CAApB,CAGA,GAAI,EAAIC,QAAJ,CAAevD,OAAnB,CAA4B,CAC1B,KAAM4D,CAAAA,KAAY,CAAGlD,IAAI,CAACmD,IAAL,CAAUN,QAAV,CAArB,CACA,KAAMO,CAAAA,QAAe,CAAGpD,IAAI,CAACC,GAAL,CAASiD,KAAT,CAAxB,CACAF,MAAM,CAAIhD,IAAI,CAACC,GAAL,CAAS,CAAC,EAAI2C,CAAL,EAAUM,KAAnB,CAAD,CAAuCE,QAAhD,CACAH,MAAM,CAAIjD,IAAI,CAACC,GAAL,CAAS2C,CAAC,CAAGM,KAAb,CAAD,CAAiCE,QAC3C,CACDH,MAAM,EAAIH,IAAV,CAEUhD,GAAG,CAAC,CAAD,CAAH,CAASiC,CAAC,CAAC,CAAD,CAAD,CAAOiB,MAAP,CAAgBhB,CAAC,CAAC,CAAD,CAAD,CAAOiB,MAA1C,CACUnD,GAAG,CAAC,CAAD,CAAH,CAASiC,CAAC,CAAC,CAAD,CAAD,CAAOiB,MAAP,CAAgBhB,CAAC,CAAC,CAAD,CAAD,CAAOiB,MAA1C,CACUnD,GAAG,CAAC,CAAD,CAAH,CAASiC,CAAC,CAAC,CAAD,CAAD,CAAOiB,MAAP,CAAgBhB,CAAC,CAAC,CAAD,CAAD,CAAOiB,MAA1C,CACUnD,GAAG,CAAC,CAAD,CAAH,CAASiC,CAAC,CAAC,CAAD,CAAD,CAAOiB,MAAP,CAAgBhB,CAAC,CAAC,CAAD,CAAD,CAAOiB,MAA1C,CACA,MAAOnD,CAAAA,GACR","sourcesContent":["import { Float, Mat4, Quat, ReadonlyQuat, ReadonlyVec3, Vec, Vec3 } from './types';\r\nimport * as array from './array';\r\nimport * as mat4 from './mat4';\r\nimport * as vec3 from './vec3';\r\nimport * as vec4 from './vec4';\r\nimport { EPSILON, fequal } from './scalar';\r\n\r\n// Temp variables\r\nconst q1: Quat = create();\r\nconst q2: Quat = create();\r\n\r\n/**\r\n * Create a new identity {@link Quat}.\r\n * @returns [0, 0, 0, 1]\r\n */\r\nexport function create(): Quat {\r\n  return [0, 0, 0, 1];\r\n}\r\n\r\n/**\r\n * Create a {@link Quat} from a unit axis vector and rotation angle in couterclockwise direction.\r\n */\r\nexport function rotateAxis(axis: ReadonlyVec3, angle: Float, out: Quat = create()): Quat {\r\n  array.scale(axis, Math.sin(angle / 2) as Float, out);\r\n  unchecked(out[3] = Math.cos(angle / 2) as Float);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a {@link Quat} from a rotation around x-axis in couterclockwise direction.\r\n * @returns the quat representing the rotation\r\n */\r\nexport function rotateX(angle: Float, out: Quat = create()): Quat {\r\n  unchecked(out[0] = Math.sin(angle / 2) as Float);\r\n  unchecked(out[3] = Math.cos(angle / 2) as Float);\r\n  unchecked(out[1] = out[2] = 0);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a {@link Quat} from a rotation around y-axis in couterclockwise direction.\r\n * @returns the quat representing the rotation\r\n */\r\nexport function rotateY(angle: Float, out: Quat = create()): Quat {\r\n  unchecked(out[1] = Math.sin(angle / 2) as Float);\r\n  unchecked(out[3] = Math.cos(angle / 2) as Float);\r\n  unchecked(out[0] = out[2] = 0);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a {@link Quat} from a rotation around z-axis in couterclockwise direction.\r\n * @returns the quat representing the rotation\r\n */\r\nexport function rotateZ(angle: Float, out: Quat = create()): Quat {\r\n  unchecked(out[2] = Math.sin(angle / 2) as Float);\r\n  unchecked(out[3] = Math.cos(angle / 2) as Float);\r\n  unchecked(out[0] = out[1] = 0);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a {@link Quat} that represents the shortest arc rotation between 2 unit vectors.\r\n * @returns the quat representing the rotation\r\n */\r\nexport function rotateTo(from: ReadonlyVec3, to: ReadonlyVec3, out: Quat = create()): Quat {\r\n  const dot: Float = vec3.dot(from, to);\r\n\r\n  if (fequal(dot, -1)) { // vectors are in parallel but opposite direction\r\n    // use arbitrary perpendicular vector = (0, z, -y)\r\n    unchecked(out[0] = 0);\r\n    unchecked(out[1] = from[2]);\r\n    unchecked(out[2] = -from[1]);\r\n    return rotateAxis(out as Vec as Vec3, Math.PI as Float, out);\r\n  } else if (fequal(dot, 1)) { // vectors are in same direction\r\n    unchecked(out[0] = out[1] = out[2] = 0);\r\n    unchecked(out[3] = 1);\r\n    return out;\r\n  }\r\n\r\n  // store perpendicular vector to the xyz of out.\r\n  vec3.cross(from, to, out as Vec as Vec3);\r\n  unchecked(out[3] = 1 + dot);\r\n  return norm(out, out);\r\n}\r\n\r\n/**\r\n * Convert a {@link Quat} to a {@link Mat4}.\r\n * @returns Mat4\r\n */\r\nexport function toMat4(q: ReadonlyQuat, out: Mat4 = mat4.create()): Mat4 {\r\n  const\r\n    xx: Float = unchecked(q[0] * q[0]),\r\n    xy: Float = unchecked(q[0] * q[1]),\r\n    xz: Float = unchecked(q[0] * q[2]),\r\n    yy: Float = unchecked(q[1] * q[1]),\r\n    yz: Float = unchecked(q[1] * q[2]),\r\n    zz: Float = unchecked(q[2] * q[2]),\r\n    wx: Float = unchecked(q[3] * q[0]),\r\n    wy: Float = unchecked(q[3] * q[1]),\r\n    wz: Float = unchecked(q[3] * q[2]);\r\n\r\n  unchecked(out[0] = 1 - 2 * (yy + zz));\r\n  unchecked(out[1] = 2 * (xy + wz));\r\n  unchecked(out[2] = 2 * (xz - wy));\r\n  unchecked(out[4] = 2 * (xy - wz));\r\n  unchecked(out[5] = 1 - 2 * (xx + zz));\r\n  unchecked(out[6] = 2 * (yz + wx));\r\n  unchecked(out[8] = 2 * (xz + wy));\r\n  unchecked(out[9] = 2 * (yz - wx));\r\n  unchecked(out[10] = 1 - 2 * (xx + yy));\r\n\r\n  unchecked(out[3] = out[7] = out[11] = out[12] = out[13] = out[14] = 0);\r\n  unchecked(out[15] = 1);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy a {@link Quat}.\r\n * @returns out\r\n */\r\nexport function copy(q: ReadonlyQuat, out: Quat = create()): Quat {\r\n  return array.copy(q, out) as Quat;\r\n}\r\n\r\n/**\r\n * Calculate dot product between 2 {@link Quat}.\r\n * @returns a * b\r\n */\r\nexport const dot: (a: ReadonlyQuat, b: ReadonlyQuat) => Float = array.dot;\r\n\r\n/**\r\n * Calculate squared length of a {@link ReadonlyQuat}.\r\n * @returns dot(v, v)\r\n */\r\nexport const len2: (v: ReadonlyQuat) => Float = vec4.len2;\r\n\r\n/**\r\n * Calculate length of a {@link Quat}.\r\n * @returns |v|\r\n */\r\nexport const len: (v: ReadonlyQuat) => Float = vec4.len;\r\n\r\n/**\r\n* Normalize a {@link Quat}.\r\n*/\r\nexport const norm: (q: ReadonlyQuat, out?: Quat) => Quat = vec4.norm;\r\n\r\n/**\r\n* Calculates the conjugate of a {@link Quat}.\r\n*/\r\nexport function conj(q: ReadonlyQuat, out: Quat = create()): Quat {\r\n  unchecked(out[0] = -q[0]);\r\n  unchecked(out[1] = -q[1]);\r\n  unchecked(out[2] = -q[2]);\r\n  unchecked(out[3] = q[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n* Calculate the inverse of a {@link Quat}.\r\n*/\r\nexport function invert(q: ReadonlyQuat, out: Quat = create()): Quat {\r\n  const l: Float = 1 / (len2(q) || 1);\r\n  unchecked(out[0] = -q[0] * l);\r\n  unchecked(out[1] = -q[1] * l);\r\n  unchecked(out[2] = -q[2] * l);\r\n  unchecked(out[3] = q[3] * l);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculate the Hamilton product of 2 {@link Quat}.\r\n * @returns out = a * b\r\n */\r\nexport function mul(a: ReadonlyQuat, b: ReadonlyQuat, out: Quat = create()): Quat {\r\n  const\r\n    ax: Float = unchecked(a[0]),\r\n    ay: Float = unchecked(a[1]),\r\n    az: Float = unchecked(a[2]),\r\n    aw: Float = unchecked(a[3]),\r\n    bx: Float = unchecked(b[0]),\r\n    by: Float = unchecked(b[1]),\r\n    bz: Float = unchecked(b[2]),\r\n    bw: Float = unchecked(b[3]);\r\n  unchecked(out[0] = aw * bx + ax * bw + ay * bz - az * by);\r\n  unchecked(out[1] = aw * by + ay * bw + az * bx - ax * bz);\r\n  unchecked(out[2] = aw * bz + az * bw + ax * by - ay * bx);\r\n  unchecked(out[3] = aw * bw - ax * bx - ay * by - az * bz);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a {@link ReadonlyVec3} using a {@link ReadonlyQuat}, by the formula v' = q * v * q^-1\r\n * @see https://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation#Using_quaternion_as_rotations\r\n * @returns out = q * v * q^-1\r\n */\r\nexport function rotateVec3(q: ReadonlyQuat, v: ReadonlyVec3, out: Vec3 = vec3.create()): Vec3 {\r\n  array.copy(v, q1, 0, 0, 3);\r\n  unchecked(q1[3] = 0);\r\n  mul(mul(q, q1, q1), invert(q, q2), q1);\r\n  return array.copy(q1, out, 0, 0, 3) as Vec3;\r\n}\r\n\r\n/**\r\n * Linear interpolate between 2 {@link Quat}.\r\n * @returns out = lerp(a, b, t)\r\n */\r\nexport function lerp(a: ReadonlyQuat, b: ReadonlyQuat, t: Float, out: Quat = create()): Quat {\r\n  const cosTheta: Float = dot(a, b);  // calculate cosine from dot product\r\n  const magB: Float = (cosTheta < 0) ? -1 : 1;\r\n\r\n  // use the shortest path and interpolate linearly\r\n  unchecked(out[0] = a[0] * (1 - t) + b[0] * magB * t);\r\n  unchecked(out[1] = a[1] * (1 - t) + b[1] * magB * t);\r\n  unchecked(out[2] = a[2] * (1 - t) + b[2] * magB * t);\r\n  unchecked(out[3] = a[3] * (1 - t) + b[3] * magB * t);\r\n\r\n  return norm(out);\r\n}\r\n\r\n/**\r\n * Spherical linear interpolate between 2 {@link Quat}.\r\n */\r\nexport function slerp(a: ReadonlyQuat, b: ReadonlyQuat, t: Float, out: Quat = create()): Quat {\r\n  let cosTheta: Float = dot(a, b);  // calculate cosine from dot product\r\n  let magB: Float = 1;\r\n  // use the shortest path\r\n  if (cosTheta < 0) {\r\n    cosTheta *= -1;\r\n    magB = -1;\r\n  }\r\n\r\n  // initialize with linear interpolation\r\n  let scale0: Float = 1 - t;\r\n  let scale1: Float = t;\r\n\r\n  // use spherical interpolation only if the quaternions are not very close\r\n  if (1 - cosTheta > EPSILON) {\r\n    const theta: Float = Math.acos(cosTheta) as Float;\r\n    const sinTheta: Float = Math.sin(theta) as Float;\r\n    scale0 = (Math.sin((1 - t) * theta) as Float) / sinTheta;\r\n    scale1 = (Math.sin(t * theta) as Float) / sinTheta;\r\n  }\r\n  scale1 *= magB;\r\n\r\n  unchecked(out[0] = a[0] * scale0 + b[0] * scale1);\r\n  unchecked(out[1] = a[1] * scale0 + b[1] * scale1);\r\n  unchecked(out[2] = a[2] * scale0 + b[2] * scale1);\r\n  unchecked(out[3] = a[3] * scale0 + b[3] * scale1);\r\n  return out;\r\n}\r\n"],"file":"quat.js"}