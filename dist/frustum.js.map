{"version":3,"file":"frustum.js","names":["vec3","plane","FRUSTUM_PLANES","v0","create","left","right","bottom","top","near","far","copy","a","out","i","fromViewProj","m","set","norm","containsPoint","f","center","radius","dist","containsAABB","box","max","min"],"sources":["../assembly/frustum.ts"],"sourcesContent":["import {\n  Float, Frustum, Plane, ReadonlyAABB, ReadonlyFrustum, ReadonlyMat4, ReadonlyVec3, Vec3\n} from './types';\nimport * as vec3 from './vec3';\nimport * as plane from './plane';\n\nconst FRUSTUM_PLANES = 6;\n\n// Temp variables\nconst v0: Vec3 = vec3.create();\n\n/**\n * Create a new {@link Frustum} from the 6 normalized planes: left, right, bottom, top, near, far.\n */\nexport function create(\n  left: Plane = plane.create(), right: Plane = plane.create(),\n  bottom: Plane = plane.create(), top: Plane = plane.create(),\n  near: Plane = plane.create(), far: Plane = plane.create()\n): Frustum {\n  return [left, right, bottom, top, near, far];\n}\n\n/**\n * Copy a {@link Frustum}.\n */\n export function copy(a: ReadonlyFrustum, out: Frustum = create()): Frustum {\n  for (let i = 0; i < FRUSTUM_PLANES; ++i) {\n    plane.copy(a[i], out[i]);\n  }\n  return out;\n}\n\n/**\n * Build a {@link Frustum} in world space from a view-projection matrix (viewProj = proj * view) using Gribb/Hartmann method.\n * @see http://www8.cs.umu.se/kurser/5DV051/HT12/lab/plane_extraction.pdf\n */\nexport function fromViewProj(m: ReadonlyMat4, out: Frustum = create()): Frustum {\n  unchecked(plane.set(out[0], m[3] + m[0], m[7] + m[4], m[11] + m[8], m[15] + m[12])); // left\n  unchecked(plane.set(out[1], m[3] - m[0], m[7] - m[4], m[11] - m[8], m[15] - m[12])); // right\n\n  unchecked(plane.set(out[2], m[3] + m[1], m[7] + m[5], m[11] + m[9], m[15] + m[13])); // bottom\n  unchecked(plane.set(out[3], m[3] - m[1], m[7] - m[5], m[11] - m[9], m[15] - m[13])); // top\n\n  unchecked(plane.set(out[4], m[3] + m[2], m[7] + m[6], m[11] + m[10], m[15] + m[14])); // near\n  unchecked(plane.set(out[5], m[3] - m[2], m[7] - m[6], m[11] - m[10], m[15] - m[14])); // far\n\n  for (let i = 0; i < FRUSTUM_PLANES; ++i) {  // normalize all planes\n    plane.norm(out[i], out[i]);\n  }\n\n  return out;\n}\n\n/**\n * Checks whether the given point / sphere defined by center and radius intersects with given {@link ReadonlyFrustum}.\n */\nexport function containsPoint(f: ReadonlyFrustum, center: ReadonlyVec3, radius: Float = 0): boolean {\n  // Check the distance of the center to the planes\n  // Point is outside frustum if it falls into the negative half-space of any plane\n  for (let i = 0; i < FRUSTUM_PLANES; ++i) {\n    if (plane.dist(f[i], center) < -radius) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Checks whether the given {@link AABB} intersects with given {@link ReadonlyFrustum}.\n */\nexport function containsAABB(f: ReadonlyFrustum, box: ReadonlyAABB): boolean {\n  for (let i = 0; i < FRUSTUM_PLANES; ++i) {\n    // Find the corner at max distance\n    unchecked(v0[0] = (f[i][0] > 0) ? box.max[0] : box.min[0]);\n    unchecked(v0[1] = (f[i][1] > 0) ? box.max[1] : box.min[1]);\n    unchecked(v0[2] = (f[i][2] > 0) ? box.max[2] : box.min[2]);\n    if (plane.dist(f[i], v0) < 0) { // max point is still outside the plane\n      return false;\n    }\n  }\n  return true;\n}\n"],"mappings":"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"}