{"version":3,"file":"aabb.js","names":["AABB","mat","vec3","v0","create","v1","min","max","copy","a","out","set","union","b","Math","intersection","transform","m","i","j","x","y","displacement","box","point","add","sub","scale","abs","dist","dxy","len","containsPoint","center","radius","intersect"],"sources":["../assembly/aabb.ts"],"sourcesContent":["import { AABB, Float, ReadonlyAABB, ReadonlyMat4, ReadonlyVec3, Vec3 } from './types';\nimport * as mat from './mat';\nimport * as vec3 from './vec3';\n\nconst v0: Vec3 = vec3.create();\nconst v1: Vec3 = vec3.create();\n\n/**\n * Create a new {@link AABB}.\n */\nexport function create(min: Vec3 = vec3.create(), max: Vec3 = vec3.create()): AABB {\n  return new AABB(min, max);\n}\n\n/**\n * Copy an {@link AABB}.\n */\nexport function copy(a: ReadonlyAABB, out: AABB = create()): AABB {\n  mat.copy(a.min, out.min);\n  mat.copy(a.max, out.max);\n  return out;\n}\n\n/**\n * Set values of an {@link AABB}.\n */\nexport function set(a: AABB, min: Vec3 = vec3.create(), max: Vec3 = vec3.create()): AABB {\n  mat.copy(min, a.min);\n  mat.copy(max, a.max);\n  return a;\n}\n\n/**\n * Calculate the union of 2 {@link ReadonlyAABB}s.\n */\nexport function union(a: ReadonlyAABB, b: ReadonlyAABB, out: AABB = create()): AABB {\n  unchecked(out.min[0] = Math.min(a.min[0], b.min[0]) as Float);\n  unchecked(out.min[1] = Math.min(a.min[1], b.min[1]) as Float);\n  unchecked(out.min[2] = Math.min(a.min[2], b.min[2]) as Float);\n  unchecked(out.max[0] = Math.max(a.max[0], b.max[0]) as Float);\n  unchecked(out.max[1] = Math.max(a.max[1], b.max[1]) as Float);\n  unchecked(out.max[2] = Math.max(a.max[2], b.max[2]) as Float);\n  return out;\n}\n\n/**\n * Calculate the intersection of 2 {@link ReadonlyAABB}s.\n */\nexport function intersection(a: ReadonlyAABB, b: ReadonlyAABB, out: AABB = create()): AABB {\n  unchecked(out.min[0] = Math.max(a.min[0], b.min[0]) as Float);\n  unchecked(out.min[1] = Math.max(a.min[1], b.min[1]) as Float);\n  unchecked(out.min[2] = Math.max(a.min[2], b.min[2]) as Float);\n  unchecked(out.max[0] = Math.min(a.max[0], b.max[0]) as Float);\n  unchecked(out.max[1] = Math.min(a.max[1], b.max[1]) as Float);\n  unchecked(out.max[2] = Math.min(a.max[2], b.max[2]) as Float);\n\n  // ensure max[i] >= min[i]\n  unchecked(out.max[0] = Math.max(out.min[0], out.max[0]) as Float);\n  unchecked(out.max[1] = Math.max(out.min[1], out.max[1]) as Float);\n  unchecked(out.max[2] = Math.max(out.min[2], out.max[2]) as Float);\n\n  return out;\n}\n\n/**\n * Efficient algorithm for transforming an {@link ReadonlyAABB}, taken from Graphics Gems.\n */\nexport function transform(a: ReadonlyAABB, m: ReadonlyMat4, out: AABB = create()): AABB {\n  // min: v0, max: v1\n  for (let i = 0; i < 3; ++i) {\n    unchecked(v0[i] = m[3 * 4 + i]);\n    unchecked(v1[i] = m[3 * 4 + i]);\n\n    for (let j = 0; j < 3; ++j) {\n      const x: Float = unchecked(a.min[j] * m[j * 4 + i]);\n      const y: Float = unchecked(a.max[j] * m[j * 4 + i]);\n      unchecked(v0[i] += Math.min(x, y) as Float);\n      unchecked(v1[i] += Math.max(x, y) as Float);\n    }\n  }\n\n  mat.copy(v0, out.min);\n  mat.copy(v1, out.max);\n  return out;\n}\n\n/**\n * Calculate the shortest signed displacement (vector distance) between the\n * {@link AABB} and the given point.\n */\nexport function displacement(box: ReadonlyAABB, point: ReadonlyVec3, out: Vec3 = vec3.create()): Vec3 {\n  // center: v0, extent: v1\n  vec3.add(box.min, box.max, v0);\n  vec3.sub(box.max, box.min, v1);\n  vec3.scale(v0, 0.5, v0);\n  vec3.scale(v1, 0.5, v1);\n\n  unchecked(out[0] = Math.abs(point[0] - v0[0]) - v1[0] as Float);\n  unchecked(out[1] = Math.abs(point[1] - v0[1]) - v1[1] as Float);\n  unchecked(out[2] = Math.abs(point[2] - v0[2]) - v1[2] as Float);\n  return out;\n}\n\n/**\n * Calculate the shortest signed distance between the {@link AABB} and the given point.\n */\nexport function dist(box: ReadonlyAABB, point: ReadonlyVec3): Float {\n  displacement(box, point, v0);\n\n  // If point is inside of the AABB, the shortest distance is the distance to closest plane\n  if (unchecked(v0[0] <= 0 && v0[1] <= 0 && v0[2] <= 0)) {\n    const dxy = Math.max(v0[0], v0[1]);\n    return Math.max(dxy, v0[2]) as Float;\n  }\n\n  unchecked(v0[0] = Math.max(0, v0[0]) as Float);\n  unchecked(v0[1] = Math.max(0, v0[1]) as Float);\n  unchecked(v0[2] = Math.max(0, v0[2]) as Float);\n  return vec3.len(v0);\n}\n\n/**\n * Checks whether the given point / sphere defined by center and radius intersects with given {@link ReadonlyAABB}.\n */\nexport function containsPoint(box: ReadonlyAABB, center: ReadonlyVec3, radius: Float = 0): boolean {\n  return dist(box, center) <= radius;\n}\n\n/**\n * Check whether 2 {@link ReadonlyAABB} intersect.\n */\nexport function intersect(a: ReadonlyAABB, b: ReadonlyAABB): boolean {\n  for (let i = 0; i < 3; ++i) {\n    if (unchecked(a.min[i] > b.max[i] || b.min[i] > a.max[i])) {\n      return false;\n    }\n  }\n  return true;\n}\n"],"mappings":"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"}