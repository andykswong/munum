{"version":3,"sources":["../assembly/aabb.ts"],"names":["AABB","array","vec3","v0","create","v1","min","max","union","a","b","out","Math","transform","m","i","j","x","y","copy","displacement","box","point","add","sub","scale","abs","dist","len","contains","intersect"],"mappings":"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","sourcesContent":["import { AABB, Float, ReadonlyAABB, ReadonlyMat4, ReadonlyVec3, Vec3 } from './types';\r\nimport * as array from './array';\r\nimport * as vec3 from './vec3';\r\n\r\nconst v0: Vec3 = vec3.create();\r\nconst v1: Vec3 = vec3.create();\r\n\r\n/**\r\n * Create a new {@link AABB}.\r\n */\r\nexport const create = (min: Vec3 = vec3.create(), max: Vec3 = vec3.create()): AABB => new AABB(min, max);\r\n\r\n/**\r\n * Calculates the union of 2 {@link ReadonlyAABB}s.\r\n */\r\nexport function union(a: ReadonlyAABB, b: ReadonlyAABB, out: AABB = create()): AABB {\r\n  unchecked(out.min[0] = Math.min(a.min[0], b.min[0]) as Float);\r\n  unchecked(out.min[1] = Math.min(a.min[1], b.min[1]) as Float);\r\n  unchecked(out.min[2] = Math.min(a.min[2], b.min[2]) as Float);\r\n  unchecked(out.max[0] = Math.max(a.max[0], b.max[0]) as Float);\r\n  unchecked(out.max[1] = Math.max(a.max[1], b.max[1]) as Float);\r\n  unchecked(out.max[2] = Math.max(a.max[2], b.max[2]) as Float);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Efficient algorithm for transforming an {@link ReadonlyAABB}, taken from Graphics Gems.\r\n */\r\nexport function transform(a: ReadonlyAABB, m: ReadonlyMat4, out: AABB = create()): AABB {\r\n  // min: v0, max: v1\r\n  for (let i = 0; i < 3; ++i) {\r\n    unchecked(v0[i] = m[3 * 4 + i]);\r\n    unchecked(v1[i] = m[3 * 4 + i]);\r\n\r\n    for (let j = 0; j < 3; ++j) {\r\n      const x: Float = unchecked(a.min[j] * m[j * 4 + i]);\r\n      const y: Float = unchecked(a.max[j] * m[j * 4 + i]);\r\n      unchecked(v0[i] += Math.min(x, y) as Float);\r\n      unchecked(v1[i] += Math.max(x, y) as Float);\r\n    }\r\n  }\r\n\r\n  array.copy(v0, out.min);\r\n  array.copy(v1, out.max);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the shortest signed displacement (vector distance) between the\r\n * {@link AABB} and the given point.\r\n */\r\nexport function displacement(box: ReadonlyAABB, point: ReadonlyVec3, out: Vec3 = vec3.create()): Vec3 {\r\n  // center: v0, extent: v1\r\n  vec3.add(box.min, box.max, v0);\r\n  vec3.sub(box.max, box.min, v1);\r\n  vec3.scale(v0, 0.5, v0);\r\n  vec3.scale(v1, 0.5, v1);\r\n\r\n  unchecked(out[0] = Math.abs(point[0] - v0[0]) - v1[0] as Float);\r\n  unchecked(out[1] = Math.abs(point[1] - v0[1]) - v1[1] as Float);\r\n  unchecked(out[2] = Math.abs(point[2] - v0[2]) - v1[2] as Float);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the shortest signed distance between the {@link AABB} and the given point.\r\n */\r\nexport function dist(box: ReadonlyAABB, point: ReadonlyVec3): Float {\r\n  displacement(box, point, v0);\r\n  unchecked(v0[0] = Math.max(0, v0[0]) as Float);\r\n  unchecked(v0[1] = Math.max(0, v0[1]) as Float);\r\n  unchecked(v0[2] = Math.max(0, v0[2]) as Float);\r\n  return (unchecked(v0[0] <= 0 && v0[1] <= 0 && v0[2] <= 0) ? -1 : 1) * vec3.len(v0);\r\n}\r\n\r\n/**\r\n * Checks whether a given point is inside the {@link ReadonlyAABB}.\r\n */\r\nexport function contains(box: ReadonlyAABB, point: ReadonlyVec3): boolean {\r\n  displacement(box, point, v0);\r\n  return unchecked(v0[0] <= 0 && v0[1] <= 0 && v0[2]) <= 0;\r\n}\r\n\r\n/**\r\n * Checks whether 2 {@link ReadonlyAABB} intersect.\r\n */\r\n export function intersect(a: ReadonlyAABB, b: ReadonlyAABB): boolean {\r\n  for (let i = 0; i < 3; ++i) {\r\n    if (unchecked(a.min[i] > b.max[i] || b.min[i] > a.max[i])) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n"],"file":"aabb.js"}